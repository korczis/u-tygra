<!DOCTYPE html>
<html lang="cs" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' cdn.tailwindcss.com cdn.jsdelivr.net www.googletagmanager.com; style-src 'self' 'unsafe-inline' fonts.googleapis.com cdn.tailwindcss.com cdn.jsdelivr.net; font-src 'self' fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self' docs.google.com www.google.com www.googletagmanager.com; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

  <!-- Primary Meta Tags -->
  <title>{% block title %}{{ config.title }}{% endblock %} | {{ config.extra.tagline }}</title>
  <meta name="title" content="{% block meta_title %}{{ config.title }} | {{ config.extra.tagline }}{% endblock %}">
  <meta name="description" content="{% block meta_description %}{{ config.description }}{% endblock %}">
  <meta name="keywords" content="pivnice, pivo, Brno, Budvar, ≈ôemesln√° piva, hospoda, Lu≈æ√°nky, craft beer, bar, pub, ƒçesk√° kuchynƒõ, chleb√≠ƒçky, salonek, oslavy">
  <meta name="author" content="{{ config.extra.business_name }}">
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  <meta name="language" content="Czech">
  <meta name="revisit-after" content="7 days">
  <meta name="rating" content="general">

  <!-- Geo Tags -->
  <meta name="geo.region" content="CZ-JM">
  <meta name="geo.placename" content="Brno">
  <meta name="geo.position" content="49.205;16.615">
  <meta name="ICBM" content="49.205, 16.615">

  <!-- Canonical URL -->
  <link rel="canonical" href="{% block canonical %}{{ config.base_url }}{% endblock %}">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="{% block og_type %}website{% endblock %}">
  <meta property="og:url" content="{% block og_url %}{{ config.base_url }}{% endblock %}">
  <meta property="og:title" content="{% block og_title %}{{ config.title }} | {{ config.extra.tagline }}{% endblock %}">
  <meta property="og:description" content="{% block og_description %}{{ config.description }}{% endblock %}">
  <meta property="og:image" content="{% block og_image %}{{ get_url(path='img/gallery/interior-main.jpg') }}{% endblock %}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Pivnice U Tygra - interi√©r s klenbov√Ωm stropem">
  <meta property="og:locale" content="cs_CZ">
  <meta property="og:site_name" content="{{ config.extra.business_name }}">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="{% block twitter_url %}{{ config.base_url }}{% endblock %}">
  <meta name="twitter:title" content="{% block twitter_title %}{{ config.title }} | {{ config.extra.tagline }}{% endblock %}">
  <meta name="twitter:description" content="{% block twitter_description %}{{ config.description }}{% endblock %}">
  <meta name="twitter:image" content="{% block twitter_image %}{{ get_url(path='img/gallery/interior-main.jpg') }}{% endblock %}">
  <meta name="twitter:image:alt" content="Pivnice U Tygra - interi√©r s klenbov√Ωm stropem">

  <!-- Apple/iOS - PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="U Tygra">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Theme Colors -->
  <meta name="theme-color" content="#2b2219" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#f08c0f" media="(prefers-color-scheme: light)">
  <meta name="msapplication-TileColor" content="#f08c0f">
  <meta name="msapplication-navbutton-color" content="#f08c0f">

  <!-- Schema.org - LocalBusiness (BarOrPub) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BarOrPub",
    "@id": "{{ config.base_url }}/#bar",
    "name": "{{ config.extra.business_name }}",
    "description": "{{ config.extra.tagline }}. Budvar a ≈ôemesln√° piva v centru Brna u parku Lu≈æ√°nky. Studen√° i tepl√° kuchynƒõ, priv√°tn√≠ salonek pro oslavy.",
    "url": "{{ config.base_url }}",
    "telephone": "{{ config.extra.phone_bar }}",
    "image": [
      "{{ get_url(path='img/gallery/interior-main.jpg') }}",
      "{{ get_url(path='img/gallery/beer-taps.jpg') }}",
      "{{ get_url(path='img/gallery/salonek-2.jpg') }}",
      "{{ get_url(path='img/gallery/food-chlebicky-1.jpg') }}"
    ],
    "logo": "{{ get_url(path='img/logo.svg') }}",
    "priceRange": "$$",
    "servesCuisine": ["Czech", "Beer", "Traditional"],
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "{{ config.extra.address }}",
      "addressLocality": "{{ config.extra.city }}",
      "postalCode": "{{ config.extra.zip }}",
      "addressCountry": "{{ config.extra.country }}"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": 49.205,
      "longitude": 16.615
    },
    "openingHoursSpecification": [
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
        "opens": "16:00",
        "closes": "00:00"
      }
    ],
    "hasMenu": {
      "@type": "Menu",
      "name": "J√≠deln√≠ l√≠stek",
      "description": "Studen√° a tepl√° kuchynƒõ k pivu"
    },
    "acceptsReservations": "True",
    "amenityFeature": [
      {"@type": "LocationFeatureSpecification", "name": "Priv√°tn√≠ salonek", "value": true},
      {"@type": "LocationFeatureSpecification", "name": "Projektor", "value": true},
      {"@type": "LocationFeatureSpecification", "name": "Klimatizace", "value": true},
      {"@type": "LocationFeatureSpecification", "name": "Venkovn√≠ zahr√°dka", "value": true}
    ],
    "sameAs": [
      "https://www.facebook.com/{{ config.extra.facebook }}"
    ],
    "potentialAction": {
      "@type": "ReserveAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "tel:{{ config.extra.phone_ops }}",
        "actionPlatform": ["http://schema.org/DesktopWebPlatform", "http://schema.org/MobileWebPlatform"]
      },
      "result": {
        "@type": "Reservation",
        "name": "Rezervace salonku"
      }
    }
  }
  </script>

  <!-- Schema.org - Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "@id": "{{ config.base_url }}/#organization",
    "name": "{{ config.extra.company }}",
    "url": "{{ config.base_url }}",
    "logo": "{{ get_url(path='img/logo.svg') }}",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "{{ config.extra.phone_bar }}",
      "contactType": "customer service",
      "availableLanguage": ["Czech", "English"]
    }
  }
  </script>

  <!-- Schema.org - WebSite -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "@id": "{{ config.base_url }}/#website",
    "url": "{{ config.base_url }}",
    "name": "{{ config.extra.business_name }}",
    "description": "{{ config.description }}",
    "publisher": {
      "@id": "{{ config.base_url }}/#organization"
    },
    "inLanguage": "cs-CZ"
  }
  </script>

  <!-- Schema.org - BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Dom≈Ø",
        "item": "{{ config.base_url }}"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Na ƒçepu",
        "item": "{{ config.base_url }}#na-cepu"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "J√≠dlo",
        "item": "{{ config.base_url }}#jidlo"
      },
      {
        "@type": "ListItem",
        "position": 4,
        "name": "Salonek",
        "item": "{{ config.base_url }}#salonek"
      },
      {
        "@type": "ListItem",
        "position": 5,
        "name": "Kontakt",
        "item": "{{ config.base_url }}#kontakt"
      }
    ]
  }
  </script>

  <!-- Favicon - Complete set for all platforms -->
  <link rel="icon" type="image/svg+xml" href="{{ get_url(path='img/logo.svg') }}">
  <link rel="icon" type="image/x-icon" href="{{ get_url(path='img/favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ get_url(path='img/favicon-16x16.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ get_url(path='img/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="48x48" href="{{ get_url(path='img/favicon-48x48.png') }}">

  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="{{ get_url(path='img/apple-touch-icon.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ get_url(path='img/apple-touch-icon.png') }}">

  <!-- Android/Chrome -->
  <link rel="manifest" href="{{ get_url(path='site.webmanifest') }}">

  <!-- Microsoft -->
  <meta name="msapplication-config" content="{{ get_url(path='browserconfig.xml') }}">
  <meta name="msapplication-TileImage" content="{{ get_url(path='img/mstile-150x150.png') }}">

  <!-- Resource hints for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://docs.google.com">
  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">

  <!-- Critical resource preloads for Core Web Vitals optimization -->
  <link rel="preload" as="image" href="{{ get_url(path='img/hero-bg.jpg') }}" fetchpriority="high">
  <link rel="preload" as="image" href="{{ get_url(path='img/logo.svg') }}" fetchpriority="high">
  <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js">
  <link rel="preload" as="script" href="{{ get_url(path='js/app.js') }}">
  <link rel="preload" as="script" href="{{ get_url(path='js/csv-worker.js') }}">

  <!-- Prefetch likely user interactions -->
  <link rel="prefetch" href="{{ get_url(path='img/gallery/interior-main.jpg') }}">
  <link rel="prefetch" href="{{ get_url(path='img/gallery/beer-taps.jpg') }}">

  <!-- Critical CSS - Inlined for instant render -->
  <style>
    /* Critical path styles for above-the-fold content */
    [x-cloak] { display: none !important; }
    html { scroll-behavior: smooth; scrollbar-gutter: stable; }
    body { background-color: #2b2219; color: #e8e5d8; font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; -webkit-font-smoothing: antialiased; }

    /* Hero critical styles */
    .hero-bg { background: linear-gradient(135deg, #0a0705 0%, #1a0f06 25%, #211408 50%, #1a0f06 75%, #0a0705 100%); position: relative; overflow: hidden; }
    .hero-bg::before { content: ''; position: absolute; inset: 0; background-image: radial-gradient(ellipse at 20% 50%, rgba(240, 140, 15, 0.06) 0%, transparent 50%), radial-gradient(ellipse at 80% 20%, rgba(187, 85, 9, 0.04) 0%, transparent 40%); pointer-events: none; }
    .hero-bg::after { content: ''; position: absolute; inset: 0; background-image: radial-gradient(circle at 25px 25px, rgba(255,255,255,0.015) 1px, transparent 0); background-size: 48px 48px; pointer-events: none; }
    .text-shadow { text-shadow: 0 4px 24px rgba(0, 0, 0, 0.5), 0 1px 4px rgba(0, 0, 0, 0.3); }
    .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(16px) saturate(1.1); -webkit-backdrop-filter: blur(16px) saturate(1.1); border: 1px solid rgba(255, 255, 255, 0.06); }
    .live-dot { width: 7px; height: 7px; border-radius: 50%; background: #22c55e; box-shadow: 0 0 8px rgba(34, 197, 94, 0.4); animation: live-pulse 2s ease-in-out infinite; }
    @keyframes live-pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.15); } }

    /* Navigation critical styles */
    nav { position: fixed; top: 0; left: 0; right: 0; z-index: 50; transition: all 0.3s; }

    /* Color system - Critical colors only */
    .text-tiger-400 { color: #f3a533; }
    .text-tiger-300 { color: #f7c46d; }
    .text-tiger-500 { color: #f08c0f; }
    .bg-tiger-500 { background-color: #f08c0f; }
    .hover\:bg-tiger-600:hover { background-color: #e17209; }
    .text-white { color: #ffffff; }
    .text-brew-100 { color: #e8e5d8; }
    .text-brew-300 { color: #b9af89; }
    .text-brew-400 { color: #a49766; }
    .text-brew-500 { color: #958757; }
    .bg-brew-950 { background-color: #2b2219; }
    .bg-brew-950\/80 { background-color: rgba(43, 34, 25, 0.8); }
    .bg-brew-950\/95 { background-color: rgba(43, 34, 25, 0.95); }
  </style>

  <!-- Google Fonts - Inter with optimized loading -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&subset=latin,latin-ext&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&subset=latin,latin-ext&display=swap" rel="stylesheet"></noscript>

  <!-- Tailwind CSS via CDN - Deferred -->
  <script>
    // Defer Tailwind loading after critical render
    document.addEventListener('DOMContentLoaded', function() {
      const script = document.createElement('script');
      script.src = 'https://cdn.tailwindcss.com';
      script.onload = function() {
        tailwind.config = {
          darkMode: 'class',
          theme: {
            extend: {
              colors: {
                tiger: {
                  50: '#fef9ee', 100: '#fdf0d3', 200: '#fadda5', 300: '#f7c46d',
                  400: '#f3a533', 500: '#f08c0f', 600: '#e17209', 700: '#bb5509',
                  800: '#95430e', 900: '#79380f', 950: '#411b05',
                },
                brew: {
                  50: '#f6f5f0', 100: '#e8e5d8', 200: '#d3cdb4', 300: '#b9af89',
                  400: '#a49766', 500: '#958757', 600: '#806e4a', 700: '#68573d',
                  800: '#584936', 900: '#4d4031', 950: '#2b2219',
                },
              },
              fontFamily: {
                display: ['Inter', 'system-ui', 'sans-serif'],
                body: ['Inter', 'system-ui', 'sans-serif'],
              },
            },
          },
        };
      };
      document.head.appendChild(script);
    });
  </script>

  <!-- Flowbite CSS - Deferred -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css';
      document.head.appendChild(link);
    });
  </script>

  <!-- Custom Styles -->
  <link rel="stylesheet" href="{{ get_url(path='css/style.css') }}">

  <!-- Base URL for JS -->
  <script>window.BASE_URL = "{{ config.base_url | safe }}";</script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ config.extra.ga_id }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ config.extra.ga_id }}');
  </script>

  {% block head %}{% endblock %}
</head>

<body class="bg-brew-950 text-brew-100 font-body antialiased" x-data="app()" x-cloak>
  {% block body %}{% endblock %}

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/js/sw.js')
          .then(registration => {
            console.log('‚úÖ Service Worker registered:', registration.scope);

            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('üîÑ New version available');
                  // Show update notification
                  if (window.showUpdateNotification) {
                    window.showUpdateNotification();
                  }
                }
              });
            });
          })
          .catch(error => {
            console.warn('‚ùå Service Worker registration failed:', error);
          });
      });
    }

    // PWA Install prompt handling
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('üíæ PWA install prompt available');
      e.preventDefault();
      deferredPrompt = e;

      // Show custom install button after user interaction
      setTimeout(() => {
        if (window.showInstallPrompt) {
          window.showInstallPrompt(deferredPrompt);
        }
      }, 10000); // Show after 10 seconds
    });

    window.addEventListener('appinstalled', () => {
      console.log('üéâ PWA was installed');
      deferredPrompt = null;
      if (window.gtag) {
        gtag('event', 'pwa_install', {
          event_category: 'engagement',
          event_label: 'PWA Installation Success'
        });
      }
    });
  </script>

  <!-- Performance monitoring (non-blocking) -->
  <script src="{{ get_url(path='js/performance.js') }}" async></script>

  <!-- Performance testing (can be disabled by removing this script) -->
  <script src="{{ get_url(path='js/performance-test.js') }}" async></script>

  <!-- Charlie Squad Analytics Dashboard (load after main app) -->
  <script src="{{ get_url(path='js/charlie-dashboard.js') }}" defer></script>

  <!-- Charlie Squad Privacy & GDPR Compliance (load early for consent management) -->
  <script src="{{ get_url(path='js/charlie-privacy.js') }}" defer></script>

  <!-- Charlie Squad Performance Monitoring (load after analytics) -->
  <script src="{{ get_url(path='js/charlie-performance.js') }}" defer></script>

  <!-- JavaScript optimization with priority loading -->
  <script>
    // Critical: Load Alpine.js with high priority after DOM ready
    document.addEventListener('DOMContentLoaded', function() {
      // Load Alpine.js first (critical for app functionality)
      const alpineScript = document.createElement('script');
      alpineScript.src = 'https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js';
      alpineScript.defer = true;
      document.head.appendChild(alpineScript);

      // Load app.js after Alpine is ready
      alpineScript.onload = function() {
        const appScript = document.createElement('script');
        appScript.src = '{{ get_url(path='js/app.js') | safe }}';
        appScript.async = true;
        document.head.appendChild(appScript);
      };

      // Load Flowbite with lower priority
      setTimeout(function() {
        const flowbiteScript = document.createElement('script');
        flowbiteScript.src = 'https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js';
        flowbiteScript.async = true;
        document.head.appendChild(flowbiteScript);
      }, 100);
    });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
